<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="code farmer."><title>Laravel PHP 打包 zip 下载 | 追赶日落日出</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?66bdd0a984d281716c78a567d1f39e67";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">首页</a><a class="sidebar-nav-item" href="/archives">归档</a><a class="sidebar-nav-item" href="/about">关于我</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Laravel/">Laravel</a></div><div class="post-time">2018-05-15</div></div></div><div class="container post-header"><h1>Laravel PHP 打包 zip 下载</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#打包文件夹-zip"><span class="toc-number">1.</span> <span class="toc-text">打包文件夹 zip</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ZipArchive-打包文件夹"><span class="toc-number">2.</span> <span class="toc-text">ZipArchive 打包文件夹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建-ZipArchive-对象"><span class="toc-number">2.1.</span> <span class="toc-text">创建 ZipArchive 对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#打开并创建-zip-文件"><span class="toc-number">2.2.</span> <span class="toc-text">打开并创建 zip 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-addFromString-addFile-向-zip-文件中添加文件"><span class="toc-number">2.3.</span> <span class="toc-text">使用 addFromString addFile 向 zip 文件中添加文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#关闭文件"><span class="toc-number">2.4.</span> <span class="toc-text">关闭文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#响应下载"><span class="toc-number">2.5.</span> <span class="toc-text">响应下载</span></a></li></ol></li></ol></details></div><div class="container post-content"><h2 id="打包文件夹-zip"><a href="#打包文件夹-zip" class="headerlink" title="打包文件夹 zip"></a>打包文件夹 zip</h2><p>通常业务都需要下载一些用户上传的文件，假如系统需要下载文件数量级非常大，则需要批量下载文件来解决效率问题。<br>批量下载，代码现实方式就是将多个文件放到同一个目录文件夹中，并打包文件夹，得到 <code>zip</code> 文件，然后再下载 <code>zip</code> 文件<br>PHP 实现这样的功能非常的简单，大概不到 10 行代码即可</p>
<h2 id="ZipArchive-打包文件夹"><a href="#ZipArchive-打包文件夹" class="headerlink" title="ZipArchive 打包文件夹"></a>ZipArchive 打包文件夹</h2><p><code>ZipArchive</code> 类使用官方文档：<a href="http://php.net/manual/zh/class.ziparchive.php" target="_blank" rel="noopener">http://php.net/manual/zh/class.ziparchive.php</a></p>
<h3 id="创建-ZipArchive-对象"><a href="#创建-ZipArchive-对象" class="headerlink" title="创建 ZipArchive 对象"></a>创建 ZipArchive 对象</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$zip = <span class="keyword">new</span> \ZipArchive();</span><br></pre></td></tr></table></figure>
<h3 id="打开并创建-zip-文件"><a href="#打开并创建-zip-文件" class="headerlink" title="打开并创建 zip 文件"></a>打开并创建 zip 文件</h3><p><code>$zip_filename</code> 存储 <code>zip</code> 文件的绝对路径</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$res = $zip-&gt;open($zip_filename, \ZipArchive::CREATE);</span><br></pre></td></tr></table></figure>
<p>第二个，参数 <code>ZipArchive::CREATE</code> 表示文件不存在时，可以进行创建</p>
<p>参数常用选项（具体可以查看官方文档）：</p>
<ul>
<li>ZipArchive::CREATE</li>
<li>ZipArchive::OVERWRITE</li>
</ul>
<h3 id="使用-addFromString-addFile-向-zip-文件中添加文件"><a href="#使用-addFromString-addFile-向-zip-文件中添加文件" class="headerlink" title="使用 addFromString addFile 向 zip 文件中添加文件"></a>使用 <code>addFromString</code> <code>addFile</code> 向 zip 文件中添加文件</h3><p>如，使用 addFromString 添加一个 <code>txt</code> readme 文件<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$zip-&gt;addFromString(<span class="string">'readme.txt'</span>, <span class="string">'使用打包下载.'</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="关闭文件"><a href="#关闭文件" class="headerlink" title="关闭文件"></a>关闭文件</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$zip-&gt;close();</span><br></pre></td></tr></table></figure>
<h3 id="响应下载"><a href="#响应下载" class="headerlink" title="响应下载"></a>响应下载</h3><p><code>$filename</code> 自定义下载文件名称<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> response()-&gt;download($zip_filename,$filename);</span><br></pre></td></tr></table></figure></p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>