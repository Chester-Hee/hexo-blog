<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="code farmer."><title>SSH 远程自动登录脚本 | 追赶日落日出</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?66bdd0a984d281716c78a567d1f39e67";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">首页</a><a class="sidebar-nav-item" href="/archives">归档</a><a class="sidebar-nav-item" href="/about">关于我</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/SSH/">SSH</a></div><div class="post-time">2019-07-10</div></div></div><div class="container post-header"><h1>SSH 远程自动登录脚本</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-expect-工具"><span class="toc-number">1.</span> <span class="toc-text">安装 expect 工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-autossh-命令"><span class="toc-number">2.</span> <span class="toc-text">安装 autossh 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#更新配置文件"><span class="toc-number">3.</span> <span class="toc-text">更新配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#远程登录服务器命令"><span class="toc-number">4.</span> <span class="toc-text">远程登录服务器命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如果自己也想写一个-SSH-自动登录脚本"><span class="toc-number">5.</span> <span class="toc-text">如果自己也想写一个 SSH 自动登录脚本</span></a></li></ol></details></div><div class="container post-content"><p>我们使用过 <code>SSH</code> 远程登录一台服务器，登录需要输入用户名和密码，并且服务器密码一般很难靠脑记住；<code>Windows</code> 用户可以使用 <code>XShell</code> 这种强大的工具，但是 Linux 或者 Mac 用户更倾向于命令行自动化脚本。</p>
<p>开源的 <code>autossh</code> 工具，就为解决这个问题，使用 expect 工具完成交互，自动根据配置用户名密码登录指定服务器。</p>
<h3 id="安装-expect-工具"><a href="#安装-expect-工具" class="headerlink" title="安装 expect 工具"></a>安装 expect 工具</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Linux:</span><br><span class="line">$ yum install expect</span><br><span class="line">$ apt-get install expect</span><br><span class="line"></span><br><span class="line">Mac:</span><br><span class="line">$ brew install expect</span><br></pre></td></tr></table></figure>
<h3 id="安装-autossh-命令"><a href="#安装-autossh-命令" class="headerlink" title="安装 autossh 命令"></a>安装 autossh 命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/FeeiCN/autossh.git</span><br><span class="line">$ sudo cp autossh/autossh /usr/local/bin/</span><br></pre></td></tr></table></figure>
<h3 id="更新配置文件"><a href="#更新配置文件" class="headerlink" title="更新配置文件"></a>更新配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ vim ~/.autosshrc</span><br><span class="line"></span><br><span class="line">添加服务器配置，如下格式：</span><br><span class="line">server_name|192.168.1.110|root|password|port|is_bastion</span><br></pre></td></tr></table></figure>
<h3 id="远程登录服务器命令"><a href="#远程登录服务器命令" class="headerlink" title="远程登录服务器命令"></a>远程登录服务器命令</h3><p>输入 <code>autossh</code> 并选择需要登录的服务器编号<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ autossh</span><br><span class="line">############################################################ </span><br><span class="line">#                     [AUTO SSH]                           # </span><br><span class="line">#                                                          # </span><br><span class="line">#                                                          # </span><br><span class="line"># [1] www.my-server.com - 192.168.192.110:root             # </span><br><span class="line">#                                                          # </span><br><span class="line">#                                                          # </span><br><span class="line">############################################################ </span><br><span class="line">Server Number: 1</span><br></pre></td></tr></table></figure></p>
<h3 id="如果自己也想写一个-SSH-自动登录脚本"><a href="#如果自己也想写一个-SSH-自动登录脚本" class="headerlink" title="如果自己也想写一个 SSH 自动登录脚本"></a>如果自己也想写一个 SSH 自动登录脚本</h3><p>可以直接使用 expect 工具，例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/expect</span><br><span class="line"></span><br><span class="line">spawn ssh root@192.168.192.110</span><br><span class="line">expect &quot;password:&quot;</span><br><span class="line"></span><br><span class="line">send &quot;12345678.\r&quot;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>先推荐一款 <code>WEB</code> 流程图在线编辑工具：<a href="https://www.draw.io" target="_blank" rel="noopener">https://www.draw.io</a></p>
</blockquote>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>