<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="code farmer."><title>Laravel-Admin Model-Grid 快速构建数据表格 | 追赶日落日出</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?66bdd0a984d281716c78a567d1f39e67";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">首页</a><a class="sidebar-nav-item" href="/archives">归档</a><a class="sidebar-nav-item" href="/about">关于我</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Laravel/">Laravel</a></div><div class="post-time">2018-04-25</div></div></div><div class="container post-header"><h1>Laravel-Admin Model-Grid 快速构建数据表格</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Laravel-Admin-快速构建数据表格之-Model-Grid"><span class="toc-number">1.</span> <span class="toc-text">Laravel Admin 快速构建数据表格之 Model-Grid</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Admin-content-…"><span class="toc-number">1.1.</span> <span class="toc-text">Admin::content(…)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Model-Grid"><span class="toc-number">1.2.</span> <span class="toc-text">Model-Grid</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#return-Administrator-grid-callback"><span class="toc-number">1.2.1.</span> <span class="toc-text">return Administrator::grid($callback)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#use-AdminBuilder"><span class="toc-number">1.2.2.</span> <span class="toc-text">use AdminBuilder</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Grid-构造函数"><span class="toc-number">1.2.3.</span> <span class="toc-text">Grid 构造函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#grid-gt-render"><span class="toc-number">1.2.4.</span> <span class="toc-text">grid-&gt;render()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#grid-gt-build"><span class="toc-number">1.2.5.</span> <span class="toc-text">grid-&gt;build()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#this-gt-processFilter"><span class="toc-number">1.2.6.</span> <span class="toc-text">$this-&gt;processFilter()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#column-gt-fill-data"><span class="toc-number">1.2.7.</span> <span class="toc-text">$column-&gt;fill($data)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#this-gt-buildRows-data"><span class="toc-number">1.2.8.</span> <span class="toc-text">$this-&gt;buildRows($data)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#view-this-gt-view-this-gt-variables-gt-render"><span class="toc-number">1.2.9.</span> <span class="toc-text">view($this-&gt;view, $this-&gt;variables())-&gt;render()</span></a></li></ol></li></ol></li></ol></details></div><div class="container post-content"><h2 id="Laravel-Admin-快速构建数据表格之-Model-Grid"><a href="#Laravel-Admin-快速构建数据表格之-Model-Grid" class="headerlink" title="Laravel Admin 快速构建数据表格之 Model-Grid"></a>Laravel Admin 快速构建数据表格之 Model-Grid</h2><p>使用LA过程中，我们是不是感觉代码变得更整洁，冗余更低，维护更简单，这都要归于LA优雅设计理念。</p>
<p>通常，一个后台管理系统最基本的操作是CRDU，对于<code>查询</code>特别是列表的查询，在传统的框架中代码的冗余非常严重。<br>对于一个列表查询其实是比较复杂的，因为它包含几个部分，<code>操作-actions</code> <code>查询条件-filters</code> <code>数据格式-display</code></p>
<p>对于LA来说，这些都变得简单起来，来看一段代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Admin::content(<span class="function"><span class="keyword">function</span> <span class="params">(Content $content)</span> </span>&#123;</span><br><span class="line">        $content-&gt;header(__db_trans(<span class="string">'admin.administrator'</span>));</span><br><span class="line">        $content-&gt;description();</span><br><span class="line">        $content-&gt;body(<span class="keyword">$this</span>-&gt;grid()-&gt;render());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">grid</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Administrator::grid(<span class="function"><span class="keyword">function</span> <span class="params">(Grid $grid)</span> </span>&#123;</span><br><span class="line">        $grid-&gt;id(<span class="string">'编号'</span>)-&gt;sortable();</span><br><span class="line">        $grid-&gt;username(__db_trans(<span class="string">'admin.username'</span>));</span><br><span class="line">        $grid-&gt;avatar(__db_trans(<span class="string">'admin.avatar'</span>))-&gt;image(<span class="string">''</span>,<span class="number">45</span>);</span><br><span class="line">        $grid-&gt;roles(__db_trans(<span class="string">'admin.roles'</span>))-&gt;pluck(<span class="string">'name'</span>)-&gt;label(<span class="string">'info'</span>);</span><br><span class="line">        $grid-&gt;created_at(__db_trans(<span class="string">'admin.created_at'</span>));</span><br><span class="line">        $grid-&gt;updated_at(__db_trans(<span class="string">'admin.updated_at'</span>));</span><br><span class="line"></span><br><span class="line">        $grid-&gt;disableExport();</span><br><span class="line"></span><br><span class="line">        $grid-&gt;actions(<span class="function"><span class="keyword">function</span> <span class="params">(Grid\Displayers\Actions $actions)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> ($actions-&gt;getKey() == <span class="number">1</span>) &#123;</span><br><span class="line">                $actions-&gt;disableDelete();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        $grid-&gt;filter(<span class="function"><span class="keyword">function</span><span class="params">($filter)</span></span>&#123;</span><br><span class="line">            $filter-&gt;like(<span class="string">'username'</span>, <span class="string">'账号名称'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面运行的结果截图</p>
<p><img src="/images/pasted-27.png" alt="upload successful"></p>
<h3 id="Admin-content-…"><a href="#Admin-content-…" class="headerlink" title="Admin::content(…)"></a>Admin::content(…)</h3><p>接下来，我们来尝试解读上文代码的含义</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> Admin::content(<span class="function"><span class="keyword">function</span> <span class="params">(Content $content)</span> </span>&#123;</span><br><span class="line">    $content-&gt;header(__db_trans(<span class="string">'admin.administrator'</span>));</span><br><span class="line">    $content-&gt;description();</span><br><span class="line">    $content-&gt;body(<span class="keyword">$this</span>-&gt;grid()-&gt;render());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>从语义和表面意思，我们很容易理解这段代码：给客户端返回一个内容块，其中包含头部，描述，内容体</p>
<p>是的，但是本文不对这个做过多的解释，本文重点是 <code>$content-&gt;body($this-&gt;grid()-&gt;render());</code> 部分</p>
<h3 id="Model-Grid"><a href="#Model-Grid" class="headerlink" title="Model-Grid"></a>Model-Grid</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;grid()-&gt;render()</span><br></pre></td></tr></table></figure>
<p>很显然，grid()返回的是一个对象，并调用render()转化为html</p>
<p>接下来，我们就进入正题，来剖析 <code>Model-Grid</code></p>
<h4 id="return-Administrator-grid-callback"><a href="#return-Administrator-grid-callback" class="headerlink" title="return Administrator::grid($callback)"></a>return Administrator::grid($callback)</h4><p>容易看出，Model 继承了LA基础类库。</p>
<h4 id="use-AdminBuilder"><a href="#use-AdminBuilder" class="headerlink" title="use AdminBuilder"></a>use AdminBuilder</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Menu</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">AdminBuilder</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以打开 AdminBuilder 源码实现</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">grid</span><span class="params">(\Closure $callback)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Grid(<span class="keyword">new</span> <span class="keyword">static</span>(), $callback);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>new static() 很关键，创建一个静态模型</p>
<h4 id="Grid-构造函数"><a href="#Grid-构造函数" class="headerlink" title="Grid 构造函数"></a>Grid 构造函数</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Eloquent $model, Closure $builder)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;keyName = $model-&gt;getKeyName();</span><br><span class="line">    <span class="keyword">$this</span>-&gt;model = <span class="keyword">new</span> Model($model);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;builder = $builder;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;setupTools();</span><br><span class="line">    <span class="keyword">$this</span>-&gt;setupFilter();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>构造函数中，完成了一些初始化工作，具体看代码也不难理解。</p>
<p>还记得 上文代码中 $this-&gt;grid()-&gt;render() 方法render()是我们的入口</p>
<h4 id="grid-gt-render"><a href="#grid-gt-render" class="headerlink" title="grid-&gt;render()"></a>grid-&gt;render()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;build();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (\<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">        <span class="keyword">return</span> Handler::renderException($e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="keyword">$this</span>-&gt;view, <span class="keyword">$this</span>-&gt;variables())-&gt;render();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>$this-&gt;view 默认值等于 table.blade</p>
<h4 id="grid-gt-build"><a href="#grid-gt-build" class="headerlink" title="grid-&gt;build()"></a>grid-&gt;build()</h4><p>如何快速构建数据表，核心方法就是它</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">build</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $data = <span class="keyword">$this</span>-&gt;processFilter();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    Column::setOriginalGridData($data);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;columns-&gt;map(<span class="function"><span class="keyword">function</span> <span class="params">(Column $column)</span> <span class="title">use</span> <span class="params">(&amp;$data)</span> </span>&#123;</span><br><span class="line">        $data = $column-&gt;fill($data);</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;buildRows($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码分析：</p>
<ul>
<li>$this-&gt;processFilter(); 这里通过Model分页条件查询并返回一个Collect集合</li>
<li>$data = $column-&gt;fill($data); 这里使用地址传递，完成数据格式化display动作</li>
<li>$this-&gt;buildRows($data); 构建一个Rows集合，提供给View渲染</li>
</ul>
<h4 id="this-gt-processFilter"><a href="#this-gt-processFilter" class="headerlink" title="$this-&gt;processFilter()"></a>$this-&gt;processFilter()</h4><p>Grid($callback) $callback 在 $this-&gt;processFilter() 进行了调用 </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">processFilter</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    call_user_func(<span class="keyword">$this</span>-&gt;builder, <span class="keyword">$this</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;filter-&gt;execute();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>回顾上面代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> Administrator::grid(<span class="function"><span class="keyword">function</span> <span class="params">(Grid $grid)</span> </span>&#123;</span><br><span class="line">   $grid-&gt;id(<span class="string">'编号'</span>)-&gt;sortable();</span><br><span class="line">   $grid-&gt;username(__db_trans(<span class="string">'admin.username'</span>));</span><br><span class="line">   $grid-&gt;avatar(__db_trans(<span class="string">'admin.avatar'</span>))-&gt;image(<span class="string">''</span>,<span class="number">45</span>);</span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>$grid-&gt;id , $grid-&gt;username , $grid-&gt;avatar 都会统一调用到 $grid __call() 方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($method, $arguments)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $label = <span class="keyword">isset</span>($arguments[<span class="number">0</span>]) ? $arguments[<span class="number">0</span>] : ucfirst($method);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">if</span> ($column = <span class="keyword">$this</span>-&gt;handleRelationColumn($method, $label)) &#123;</span><br><span class="line">        <span class="keyword">return</span> $column;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($column = <span class="keyword">$this</span>-&gt;handleTableColumn($method, $label)) &#123;</span><br><span class="line">        <span class="keyword">return</span> $column;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;addColumn($method, $label);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现工作就是 $this-&gt;columns[] = $column;</p>
<p>接下来，就是</p>
<p>$this-&gt;filter-&gt;execute();<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">buildData</span><span class="params">($toArray = true)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $collection = <span class="keyword">$this</span>-&gt;get();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;data = $collection-&gt;toArray();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>这里巧妙实现了第三方接口快速生成数据表格的支持</strong></p>
<p>$this-&gt;get() </p>
<p>方式会调用Model的paginate()方法来获取数据列表，所以通过实现此方法可以很好解决数据源问题。</p>
<p>如，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">paginate</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $page_size = request()-&gt;input(<span class="string">'per_page'</span>, <span class="number">20</span>);</span><br><span class="line">    $cur_page = request()-&gt;input(<span class="string">'page'</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    $data = <span class="keyword">$this</span>-&gt;service-&gt;statisticList($cur_page, $page_size);</span><br><span class="line">    $total = intval($data);</span><br><span class="line">    </span><br><span class="line">    $paginator = <span class="keyword">new</span> LengthAwarePaginator($data, $total, $page_size, $cur_page);</span><br><span class="line">    $paginator-&gt;setPath(url()-&gt;current());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $paginator;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="column-gt-fill-data"><a href="#column-gt-fill-data" class="headerlink" title="$column-&gt;fill($data)"></a>$column-&gt;fill($data)</h4><p>$column-&gt;fill($data) 就是对数据进行格式化，并使用display方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fill</span><span class="params">(array $data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span> ($data <span class="keyword">as</span> $key =&gt; &amp;$row) &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;original = $value = array_get($row, <span class="keyword">$this</span>-&gt;name);</span><br><span class="line"></span><br><span class="line">        $value = <span class="keyword">$this</span>-&gt;htmlEntityEncode($value);</span><br><span class="line"></span><br><span class="line">        array_set($row, <span class="keyword">$this</span>-&gt;name, $value);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;hasDisplayCallbacks()) &#123;</span><br><span class="line">            $value = <span class="keyword">$this</span>-&gt;callDisplayCallbacks(<span class="keyword">$this</span>-&gt;original, $key);</span><br><span class="line">            array_set($row, <span class="keyword">$this</span>-&gt;name, $value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于display 方法，其实LA提供了扩展。</p>
<p>Bootstrap.php Middleware文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$map = [</span><br><span class="line">    <span class="string">'editable'</span> =&gt; \App\Core\Grid\Displayers\Editable::class,</span><br><span class="line">    <span class="string">'switch'</span> =&gt; \App\Core\Grid\Displayers\SwitchDisplay::class,</span><br><span class="line">    <span class="string">'switchGroup'</span> =&gt; \App\Core\Grid\Displayers\SwitchGroup::class,</span><br><span class="line">    <span class="string">'select'</span> =&gt; \App\Core\Grid\Displayers\Select::class,</span><br><span class="line">    <span class="string">'image'</span> =&gt; \App\Core\Grid\Displayers\Image::class,</span><br><span class="line">    <span class="string">'label'</span> =&gt; \App\Core\Grid\Displayers\Label::class,</span><br><span class="line">    <span class="string">'button'</span> =&gt; \App\Core\Grid\Displayers\Button::class,</span><br><span class="line">    <span class="string">'link'</span> =&gt; \App\Core\Grid\Displayers\Link::class,</span><br><span class="line">    <span class="string">'badge'</span> =&gt; \App\Core\Grid\Displayers\Badge::class,</span><br><span class="line">    <span class="string">'progressBar'</span> =&gt; \App\Core\Grid\Displayers\ProgressBar::class,</span><br><span class="line">    <span class="string">'radio'</span> =&gt; \App\Core\Grid\Displayers\Radio::class,</span><br><span class="line">    <span class="string">'checkbox'</span> =&gt; \App\Core\Grid\Displayers\Checkbox::class,</span><br><span class="line">    <span class="string">'orderable'</span> =&gt; \App\Core\Grid\Displayers\Orderable::class,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($map <span class="keyword">as</span> $abstract =&gt; $class) &#123;</span><br><span class="line">    Column::extend($abstract, $class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>让你的列表元素更丰富。</p>
<h4 id="this-gt-buildRows-data"><a href="#this-gt-buildRows-data" class="headerlink" title="$this-&gt;buildRows($data)"></a>$this-&gt;buildRows($data)</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;rows = collect($data)-&gt;map(<span class="function"><span class="keyword">function</span> <span class="params">($model, $number)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Row($number, $model);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>构建一个Rows集合，用于前端模板渲染。</p>
<h4 id="view-this-gt-view-this-gt-variables-gt-render"><a href="#view-this-gt-view-this-gt-variables-gt-render" class="headerlink" title="view($this-&gt;view, $this-&gt;variables())-&gt;render()"></a>view($this-&gt;view, $this-&gt;variables())-&gt;render()</h4><p>好，最后我们来看一下table.blade这个文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;table class="table table-hover table-border table-striped"&gt;</span><br><span class="line">    &lt;tr class="text-center"&gt;</span><br><span class="line">    @<span class="keyword">foreach</span>($grid-&gt;columns() <span class="keyword">as</span> $column)</span><br><span class="line">         &lt;th&gt;&#123;&#123;$column-&gt;getLabel()&#125;&#125;&#123;!! $column-&gt;sorter() !!&#125;&lt;/th&gt;</span><br><span class="line">    @<span class="keyword">endforeach</span></span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">    @<span class="keyword">foreach</span>($grid-&gt;rows() <span class="keyword">as</span> $row)</span><br><span class="line">    &lt;tr &#123;!! $row-&gt;getRowAttributes() !!&#125;&gt;</span><br><span class="line">          @<span class="keyword">foreach</span>($grid-&gt;columnNames <span class="keyword">as</span> $name)</span><br><span class="line">          &lt;td &#123;!! $row-&gt;getColumnAttributes($name) !!&#125;&gt;</span><br><span class="line">                &#123;!! $row-&gt;column($name) !!&#125;</span><br><span class="line">          &lt;/td&gt;</span><br><span class="line">          @<span class="keyword">endforeach</span></span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    @<span class="keyword">endforeach</span></span><br><span class="line">    </span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<p>简单分析一下Model-Grid源代码实现流程与原理，希望对你会有一点帮助。</p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>