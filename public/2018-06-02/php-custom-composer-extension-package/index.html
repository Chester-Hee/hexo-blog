<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="code farmer."><title>PHP自定义Composer扩展包 | 追赶日落日出</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?66bdd0a984d281716c78a567d1f39e67";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">首页</a><a class="sidebar-nav-item" href="/archives">归档</a><a class="sidebar-nav-item" href="/about">关于我</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Composer/">Composer</a><a class="post-tag-link" href="/tags/PHP/">PHP</a></div><div class="post-time">2018-06-02</div></div></div><div class="container post-header"><h1>PHP自定义Composer扩展包</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Install"><span class="toc-number">2.</span> <span class="toc-text">Install</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Windows，Linux，Mac"><span class="toc-number">2.0.1.</span> <span class="toc-text">Windows，Linux，Mac</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#所有的环境都可以使用PHP命令行进行安装"><span class="toc-number">2.0.2.</span> <span class="toc-text">所有的环境都可以使用PHP命令行进行安装</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#首先，下载composer-setup"><span class="toc-number">2.0.2.1.</span> <span class="toc-text">首先，下载composer-setup</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#最后，开始安装"><span class="toc-number">2.0.2.2.</span> <span class="toc-text">最后，开始安装</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#安装选项"><span class="toc-number">2.0.2.3.</span> <span class="toc-text">安装选项</span></a></li></ol></li></ol></li></ol><li class="toc-item toc-level-3"><a class="toc-link" href="#初始化自定义扩展包目录"><span class="toc-number">3.</span> <span class="toc-text">初始化自定义扩展包目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现扩展源码"><span class="toc-number">4.</span> <span class="toc-text">实现扩展源码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mkdir目录结构"><span class="toc-number">4.1.</span> <span class="toc-text">mkdir目录结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#new-Class"><span class="toc-number">4.2.</span> <span class="toc-text">new Class</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#初始化git，到GitHub创建一个代码库"><span class="toc-number">4.3.</span> <span class="toc-text">初始化git，到GitHub创建一个代码库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编辑composer-json文件，配置自动加载-autoLoad"><span class="toc-number">5.</span> <span class="toc-text">编辑composer.json文件，配置自动加载 autoLoad</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在项目中使用扩展-helingfeng-my-composer"><span class="toc-number">6.</span> <span class="toc-text">在项目中使用扩展 helingfeng/my-composer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#首先，创建自定义扩展tag，如1-0"><span class="toc-number">6.1.</span> <span class="toc-text">首先，创建自定义扩展tag，如1.0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#在项目中配置Composer-来源"><span class="toc-number">6.2.</span> <span class="toc-text">在项目中配置Composer 来源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用扩展类"><span class="toc-number">6.3.</span> <span class="toc-text">使用扩展类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#运行index-php输出"><span class="toc-number">6.4.</span> <span class="toc-text">运行index.php输出</span></a></li></ol></li></details></div><div class="container post-content"><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>Composer PHP扩展包依赖管理工具，类似java的maven，javascirpt的npm</p>
<p>Composer的出现让PHP发生了质的变化，头痛的代码库依赖问题，包版本问题得以解决</p>
<p>Composer是一个基于PHP的程序，所以安装Composer之前必须得安装PHP环境</p>
<h3 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h3><h5 id="Windows，Linux，Mac"><a href="#Windows，Linux，Mac" class="headerlink" title="Windows，Linux，Mac"></a>Windows，Linux，Mac</h5><p>Composer下载地址：<a href="https://getcomposer.org/download/" title="https://getcomposer.org/download/" target="_blank" rel="noopener">https://getcomposer.org/download/</a></p>
<h5 id="所有的环境都可以使用PHP命令行进行安装"><a href="#所有的环境都可以使用PHP命令行进行安装" class="headerlink" title="所有的环境都可以使用PHP命令行进行安装"></a>所有的环境都可以使用PHP命令行进行安装</h5><h6 id="首先，下载composer-setup"><a href="#首先，下载composer-setup" class="headerlink" title="首先，下载composer-setup"></a>首先，下载composer-setup</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">"copy('https://getcomposer.org/installer', 'composer-setup.php');"</span></span><br><span class="line">php -r <span class="string">"if (hash_file('SHA384', 'composer-setup.php') === '544e09ee996cdf60ece3804abc52599c22b1f40f4323403c44d44fdfdd586475ca9813a858088ffbc1f233e9b180f061') &#123; echo 'Installer verified'; &#125; else &#123; echo 'Installer corrupt'; unlink('composer-setup.php'); &#125; echo PHP_EOL;"</span></span><br><span class="line">php composer-setup.php</span><br><span class="line">php -r <span class="string">"unlink('composer-setup.php');"</span></span><br></pre></td></tr></table></figure>
<h6 id="最后，开始安装"><a href="#最后，开始安装" class="headerlink" title="最后，开始安装"></a>最后，开始安装</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php composer-setup.php --install-dir=bin</span><br></pre></td></tr></table></figure>
<h6 id="安装选项"><a href="#安装选项" class="headerlink" title="安装选项"></a>安装选项</h6><ul>
<li>–install-dir=bin   （安装路径）</li>
<li>–filename=composer  （安装文件名称）</li>
<li>–version=1.0.0-alpha8 （版本）</li>
</ul>
<h3 id="初始化自定义扩展包目录"><a href="#初始化自定义扩展包目录" class="headerlink" title="初始化自定义扩展包目录"></a>初始化自定义扩展包目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir my-composer</span><br><span class="line">cd my-composer</span><br><span class="line">composer init</span><br></pre></td></tr></table></figure>
<p>init命令会提示你输入扩展包的一下基本信息和依赖信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">vim composer.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    "name": "helingfeng/my-composer",</span><br><span class="line">    "authors": [</span><br><span class="line">        &#123;</span><br><span class="line">            "name": "helingfeng",</span><br><span class="line">            "email": "857190327@qq.com"</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    "require": &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="实现扩展源码"><a href="#实现扩展源码" class="headerlink" title="实现扩展源码"></a>实现扩展源码</h3><p>假设，我们希望实现一个 Md5+salt 密码加密扩展。</p>
<h4 id="mkdir目录结构"><a href="#mkdir目录结构" class="headerlink" title="mkdir目录结构"></a>mkdir目录结构</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p src/Md5salt</span><br></pre></td></tr></table></figure>
<h4 id="new-Class"><a href="#new-Class" class="headerlink" title="new Class"></a>new Class</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch Auth.php</span><br><span class="line">vim Auth.php</span><br></pre></td></tr></table></figure>
<p>写入代码<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Md5salt</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Auth</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">password2security</span><span class="params">($password)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $random_str = <span class="keyword">$this</span>-&gt;createRandomStr();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="string">'password'</span>=&gt;md5($password.$random_str) , <span class="string">'salt'</span>=&gt;$random_str];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">createRandomStr</span><span class="params">($len = <span class="number">10</span>)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        $chars = <span class="string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"</span>;</span><br><span class="line">        $str = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $len; $i++) &#123;</span><br><span class="line">            $str .= substr($chars, mt_rand(<span class="number">0</span>, strlen($chars) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="初始化git，到GitHub创建一个代码库"><a href="#初始化git，到GitHub创建一个代码库" class="headerlink" title="初始化git，到GitHub创建一个代码库"></a>初始化git，到GitHub创建一个代码库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;first commit&quot;</span><br><span class="line">git remote add origin https://github.com/helingfeng/TestComposer.git</span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br><span class="line">成功Push提示：</span><br><span class="line"></span><br><span class="line">Delta compression using up to 4 threads.</span><br><span class="line">压缩对象中: 100% (4/4), 完成.</span><br><span class="line">写入对象中: 100% (6/6), 764 bytes | 0 bytes/s, 完成.</span><br><span class="line">Total 6 (delta 0), reused 0 (delta 0)</span><br><span class="line">To https://github.com/helingfeng/TestComposer.git</span><br><span class="line"> * [new branch]      master -&gt; master</span><br><span class="line">分支 master 设置为跟踪来自 origin 的远程分支 master。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>到这里，我们已经准备好了扩展程序。</p>
</blockquote>
<h3 id="编辑composer-json文件，配置自动加载-autoLoad"><a href="#编辑composer-json文件，配置自动加载-autoLoad" class="headerlink" title="编辑composer.json文件，配置自动加载 autoLoad"></a>编辑composer.json文件，配置自动加载 autoLoad</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim composer.json</span><br></pre></td></tr></table></figure>
<p>配置扩展包源码路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;helingfeng/my-composer&quot;,</span><br><span class="line">  &quot;authors&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;hechao&quot;,</span><br><span class="line">      &quot;email&quot;: &quot;hechao-d@dfl.com&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;require&quot;: &#123;&#125;,</span><br><span class="line">  &quot;autoload&quot;: &#123;</span><br><span class="line">    &quot;psr-4&quot;: &#123;</span><br><span class="line">      &quot;Md5salt\\&quot;: &quot;src/Md5salt/&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;repositories&quot;: &#123;</span><br><span class="line">    &quot;packagist&quot;: &#123;</span><br><span class="line">      &quot;type&quot;: &quot;composer&quot;,</span><br><span class="line">      &quot;url&quot;: &quot;https://packagist.phpcomposer.com&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="在项目中使用扩展-helingfeng-my-composer"><a href="#在项目中使用扩展-helingfeng-my-composer" class="headerlink" title="在项目中使用扩展 helingfeng/my-composer"></a>在项目中使用扩展 helingfeng/my-composer</h3><h4 id="首先，创建自定义扩展tag，如1-0"><a href="#首先，创建自定义扩展tag，如1-0" class="headerlink" title="首先，创建自定义扩展tag，如1.0"></a>首先，创建自定义扩展tag，如1.0</h4><p><a href="https://github.com/helingfeng/TestComposer/tree/1.0" title="https://github.com/helingfeng/TestComposer/tree/1.0" target="_blank" rel="noopener">https://github.com/helingfeng/TestComposer/tree/1.0</a></p>
<h4 id="在项目中配置Composer-来源"><a href="#在项目中配置Composer-来源" class="headerlink" title="在项目中配置Composer 来源"></a>在项目中配置Composer 来源</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&quot;repositories&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;composer&quot;,</span><br><span class="line">      &quot;url&quot;: &quot;https://packagist.phpcomposer.com&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;packagist&quot;: false</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;git&quot;,</span><br><span class="line">      &quot;url&quot;: &quot;https://github.com/helingfeng/TestComposer.git&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure>
<p>require依赖自定义扩展</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">composer require helingfeng/my-composer 1.0</span><br><span class="line"></span><br><span class="line">成功输出：</span><br><span class="line"></span><br><span class="line">./composer.json has been updated</span><br><span class="line">Loading composer repositories with package information                             Package operations: 1 install, 0 updates, 0 removals</span><br><span class="line">  - Installing helingfeng/my-composer (1.0): Cloning e0b108628d from cache</span><br><span class="line">Writing lock file</span><br><span class="line">Generating autoload files</span><br></pre></td></tr></table></figure>
<h4 id="使用扩展类"><a href="#使用扩展类" class="headerlink" title="使用扩展类"></a>使用扩展类</h4><p>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="keyword">__DIR__</span> . <span class="string">'/../vendor/autoload.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Md5salt</span>\<span class="title">Auth</span>;</span><br><span class="line"></span><br><span class="line">$password = <span class="string">'123456'</span>;</span><br><span class="line">$auth = <span class="keyword">new</span> Auth();</span><br><span class="line"></span><br><span class="line">$security = $auth-&gt;password2security($password);</span><br><span class="line"></span><br><span class="line">var_dump($security);</span><br></pre></td></tr></table></figure>
<h4 id="运行index-php输出"><a href="#运行index-php输出" class="headerlink" title="运行index.php输出"></a>运行index.php输出</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">array(2) &#123;</span><br><span class="line">  'password' =&gt;</span><br><span class="line">  string(32) "79a9fb766f3e301751d248aa1a69194a"</span><br><span class="line">  'salt' =&gt;</span><br><span class="line">  string(10) "XxYD9XBFMB"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>